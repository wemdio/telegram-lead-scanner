# Исправление проблемы со смещением данных в Google Sheets

## Проблема
После 97 строки данные съехали вправо на несколько столбцов, и столбцы до сих пор не подписаны.

## Решение

### 1. Настройка реального Google Spreadsheet

1. Создайте новую Google Таблицу:
   - Перейдите на https://sheets.google.com
   - Создайте новую таблицу
   - Скопируйте ID таблицы из URL (часть между `/d/` и `/edit`)

2. Обновите файл `.env` в папке `backend`:
   ```
   GOOGLE_SPREADSHEET_ID=ваш_реальный_id_таблицы
   ```

3. Настройте Google Sheets API:
   - Перейдите в Google Cloud Console
   - Создайте сервисный аккаунт
   - Скачайте JSON файл с ключами
   - Обновите переменные в `.env`:
     ```
     GOOGLE_SHEETS_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n"
     GOOGLE_SHEETS_CLIENT_EMAIL="your-service-account@project.iam.gserviceaccount.com"
     GOOGLE_SHEETS_PROJECT_ID="your-project-id"
     ```

### 2. Сброс таблицы с правильными заголовками

После настройки реального Spreadsheet ID выполните:

```powershell
# Перезапустите backend сервер
cd backend
npm start

# В новом терминале выполните сброс таблицы
Invoke-RestMethod -Uri "http://localhost:3001/api/sheets/reset" -Method POST -ContentType "application/json" -Body '{"spreadsheetId": "ваш_реальный_id_таблицы"}'
```

Или используйте скрипт:
```powershell
node reset_spreadsheet.cjs
```

### 3. Что делает сброс таблицы

- Очищает все данные в таблице
- Устанавливает правильные заголовки колонок:
  - Date (Дата)
  - Time (Время)
  - Channel (Канал)
  - Sender (Отправитель)
  - Message (Сообщение)
  - Message ID (ID сообщения)
  - Chat ID (ID чата)
  - Type (Тип)
- Форматирует заголовки (жирный шрифт, выравнивание)

### 4. Проверка результата

После сброса:
1. Откройте вашу Google Таблицу
2. Убедитесь, что заголовки установлены правильно
3. Запустите сканирование сообщений - новые данные будут записываться в правильные колонки

### 5. Альтернативное решение

Если вы хотите сохранить существующие данные:

1. Вручную добавьте заголовки в первую строку таблицы:
   `Date | Time | Channel | Sender | Message | Message ID | Chat ID | Type`

2. Вызовите эндпоинт для принудительного обновления заголовков:
   ```powershell
   Invoke-RestMethod -Uri "http://localhost:3001/api/sheets/headers?forceUpdate=true" -Method POST -ContentType "application/json" -Body '{"spreadsheetId": "ваш_id_таблицы"}'
   ```

## Важные замечания

- Убедитесь, что сервисный аккаунт Google имеет доступ к вашей таблице (добавьте email сервисного аккаунта как редактора)
- После настройки реального Spreadsheet ID все новые сообщения будут записываться с правильным выравниванием
- Функция `forceUpdate=true` в эндпоинте `/headers` обеспечивает правильное выравнивание данных