# Полная инструкция по установке Telegram Lead Scanner на новый компьютер

## Системные требования
- Windows 10/11
- Node.js версии 18 или выше
- PowerShell 5.0 или выше
- Интернет-соединение

## 1. Установка зависимостей

### 1.1 Установка Node.js
1. Скачайте Node.js с официального сайта: https://nodejs.org/
2. Выберите LTS версию (рекомендуется)
3. Запустите установщик и следуйте инструкциям
4. Проверьте установку в PowerShell:
   ```powershell
   node --version
   npm --version
   ```

### 1.2 Подготовка проекта
1. Скопируйте папку с проектом на новый компьютер
2. Откройте PowerShell от имени администратора
3. Перейдите в папку проекта:
   ```powershell
   cd "путь\к\папке\проекта"
   ```

### 1.3 Установка зависимостей фронтенда
```powershell
npm install
```

### 1.4 Установка зависимостей бэкенда
```powershell
cd backend
npm install
cd ..
```

## 2. Настройка переменных окружения

### 2.1 Создание файла .env.local
Создайте файл `.env.local` в корневой папке проекта со следующим содержимым:

```env
# AI Provider Configuration (выберите один)
GEMINI_API_KEY=ваш_ключ_gemini
# или
OPENAI_API_KEY=ваш_ключ_openai
# или
ANTHROPIC_API_KEY=ваш_ключ_anthropic

# Telegram Configuration
TELEGRAM_API_ID=ваш_api_id
TELEGRAM_API_HASH=ваш_api_hash
TELEGRAM_BOT_TOKEN=ваш_bot_token
TELEGRAM_CHANNEL_ID=ваш_channel_id

# Google Sheets Configuration
GOOGLE_SHEETS_SPREADSHEET_ID=ваш_spreadsheet_id
```

### 2.2 Создание файла backend/.env
Создайте файл `.env` в папке `backend` с аналогичным содержимым:

```env
# AI Provider Configuration
GEMINI_API_KEY=ваш_ключ_gemini
OPENAI_API_KEY=ваш_ключ_openai
ANTHROPIC_API_KEY=ваш_ключ_anthropic

# Telegram Configuration
TELEGRAM_API_ID=ваш_api_id
TELEGRAM_API_HASH=ваш_api_hash
TELEGRAM_BOT_TOKEN=ваш_bot_token
TELEGRAM_CHANNEL_ID=ваш_channel_id

# Google Sheets Configuration
GOOGLE_SHEETS_SPREADSHEET_ID=ваш_spreadsheet_id

# Server Configuration
PORT=3001
NODE_ENV=development
```

## 3. Настройка Google Sheets API

### 3.1 Создание проекта в Google Cloud Console
1. Перейдите на https://console.cloud.google.com/
2. Создайте новый проект или выберите существующий
3. Включите Google Sheets API:
   - Перейдите в "APIs & Services" > "Library"
   - Найдите "Google Sheets API"
   - Нажмите "Enable"

### 3.2 Создание Service Account
1. Перейдите в "APIs & Services" > "Credentials"
2. Нажмите "Create Credentials" > "Service Account"
3. Заполните информацию о сервисном аккаунте
4. Нажмите "Create and Continue"
5. Пропустите роли (необязательно)
6. Нажмите "Done"

### 3.3 Создание ключа JSON
1. Найдите созданный Service Account в списке
2. Нажмите на него
3. Перейдите на вкладку "Keys"
4. Нажмите "Add Key" > "Create New Key"
5. Выберите "JSON" и нажмите "Create"
6. Сохраните скачанный файл как `google-credentials.json` в папке `backend`

### 3.4 Настройка Google Sheets
1. Создайте новую Google Таблицу
2. Скопируйте ID таблицы из URL (часть между `/d/` и `/edit`)
3. Добавьте email сервисного аккаунта как редактора таблицы:
   - Нажмите "Share" в правом верхнем углу
   - Вставьте email из файла `google-credentials.json` (поле "client_email")
   - Выберите роль "Editor"
   - Нажмите "Send"

### 3.5 Структура таблицы
Создайте листы с названиями:
- `Settings` - для настроек системы
- `Leads` - для хранения лидов
- `SentLeads` - для отправленных лидов

## 4. Настройка Telegram Bot

### 4.1 Создание бота
1. Найдите @BotFather в Telegram
2. Отправьте команду `/newbot`
3. Следуйте инструкциям для создания бота
4. Сохраните полученный токен

### 4.2 Получение Channel ID
1. Добавьте бота в ваш канал как администратора
2. Отправьте сообщение в канал
3. Перейдите по ссылке: `https://api.telegram.org/bot<ВАШ_ТОКЕН>/getUpdates`
4. Найдите `chat.id` в ответе (это будет отрицательное число)

### 4.3 Получение Telegram API credentials
1. Перейдите на https://my.telegram.org/
2. Войдите в свой аккаунт
3. Перейдите в "API development tools"
4. Создайте новое приложение
5. Сохраните `api_id` и `api_hash`

## 5. Запуск системы

### 5.1 Сборка фронтенда
```powershell
npm run build
```

### 5.2 Запуск бэкенда
Откройте новое окно PowerShell и выполните:
```powershell
cd backend
npm start
```

### 5.3 Запуск фронтенда (для разработки)
В другом окне PowerShell:
```powershell
npm run dev
```

### 5.4 Запуск как Electron приложение
```powershell
npm run electron
```

## 6. Проверка работоспособности

### 6.1 Проверка бэкенда
Откройте браузер и перейдите по адресу: http://localhost:3001/api/health

### 6.2 Проверка Telegram бота
```powershell
curl http://localhost:3001/api/telegram-bot/test
```

### 6.3 Проверка автоматической отправки
```powershell
# Проверка статуса cron job
Invoke-RestMethod -Uri "http://localhost:3001/api/cron/status" -Method GET

# Запуск cron job
Invoke-RestMethod -Uri "http://localhost:3001/api/cron/start" -Method POST

# Ручная отправка лидов (для тестирования)
Invoke-RestMethod -Uri "http://localhost:3001/api/cron/send-leads" -Method POST
```

## 7. Возможные проблемы и решения

### 7.1 Ошибки установки зависимостей
- Убедитесь, что Node.js установлен корректно
- Запустите PowerShell от имени администратора
- Очистите кэш npm: `npm cache clean --force`

### 7.2 Ошибки Google Sheets API
- Проверьте правильность пути к файлу `google-credentials.json`
- Убедитесь, что сервисный аккаунт добавлен как редактор таблицы
- Проверьте правильность Spreadsheet ID

### 7.3 Ошибки Telegram
- Проверьте правильность токена бота
- Убедитесь, что бот добавлен в канал как администратор
- Проверьте правильность Channel ID (должен быть отрицательным числом)

### 7.4 Конфликты портов
- Убедитесь, что порты 3001 и 5173 свободны
- Закройте все предыдущие экземпляры приложения

## 8. Автоматический запуск

Для автоматического запуска при старте системы создайте bat-файл:

```batch
@echo off
cd /d "путь\к\папке\проекта"
start "Backend" cmd /k "cd backend && npm start"
timeout /t 5
start "Frontend" cmd /k "npm run electron"
```

Сохраните как `start-telegram-scanner.bat` и добавьте в автозагрузку Windows.

---

**Важно:** Перед запуском убедитесь, что все переменные окружения настроены правильно и все сервисы (Google Sheets, Telegram Bot) настроены корректно.